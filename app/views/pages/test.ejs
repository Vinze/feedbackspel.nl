<!DOCTYPE html>
<html lang="nl">
<head>
	<% include ../includes/head %>
	<style type="text/css">
	.player-list {
		width: 300px;
		margin: 0px auto;
	}
	label.star {
		padding: 5px 10px;
		background-color: #fff;
		margin-right: 4px;
		border: 1px solid #e5e5e5;
		border-radius: 50px;
	}
	label.star.selected {
		background-color: rgb(255, 174, 0);
		border: 1px solid rgb(218, 149, 0);
	}
	label.star.disabled {
		background-color: #f2f2f2;
		pointer: default;
	}
	label.star input {
		visibility: hidden;
	}
	</style>
</head>
<body>
<% include ../includes/top %>
<div class="content-wrapper">
	<div class="content container">
		<div class="player-list" id="content">
			
		</div>
	</div>
</div>
<% include ../includes/bottom %>

<script type="text/template" id="template">
	<p>Stars: {{starsGiven}} / {{starsMax}} ({{starsAvailable}})</p>
	{{#each players:i}}
		<p>
			{{name}} ({{ratings[id] || 1}}):<br>

			<label class="star{{ratings[id] >= 1 || !ratings[id] ? ' selected' : ''}}{{(5 - ratings[id]) - starsAvailable >= 5 ? ' disabled' : ''}}">
				<input type="radio" class="radio" name="rating[{{i}}]" value="1" {{((5 - ratings[id]) - starsAvailable) >= 5 ? 'disabled' : ''}} on-click="setRating:{{this}}">
			</label>

			<label class="star{{ratings[id] >= 2 ? ' selected' : ''}}{{((5 - ratings[id]) - starsAvailable) >= 4 ? ' disabled' : ''}}">
				<input type="radio" class="radio" name="rating[{{i}}]" value="2" {{((5 - ratings[id]) - starsAvailable) >= 4 ? 'disabled' : ''}} on-click="setRating:{{this}}">
			</label>

			<label class="star{{ratings[id] >= 3 ? ' selected' : ''}}{{((5 - ratings[id]) - starsAvailable) >= 3 ? ' disabled' : ''}}">
				<input type="radio" class="radio" name="rating[{{i}}]" value="3" {{((5 - ratings[id]) - starsAvailable) >= 3 ? 'disabled' : ''}} on-click="setRating:{{this}}">
			</label>

			<label class="star{{ratings[id] >= 4 ? ' selected' : ''}}{{(5 - ratings[id]) - (starsMax - 
			starsGiven) >= 2 ? ' disabled' : ''}}">
				<input type="radio" class="radio" name="rating[{{i}}]" value="4" {{((5 - ratings[id]) - starsAvailable) >= 2 ? 'disabled' : ''}} on-click="setRating:{{this}}">
			</label>

			<label class="star{{ratings[id] >= 5 ? ' selected' : ''}}{{((5 - ratings[id]) - starsAvailable) >= 1 ? ' disabled' : ''}}">
				<input type="radio" class="radio" name="rating[{{i}}]" value="5" {{((5 - ratings[id]) - starsAvailable) >= 1 ? 'disabled' : ''}} on-click="setRating:{{this}}">
			</label>

		</p>
	{{/each}}
	<p>
		<a href="#" on-click="clear" class="btn danger"><i class="fa fa-trash-o"></i> Reset</a>
		<button class="btn confirm" on-click="save"><i class="fa fa-check"></i> Save</button>
	</p>
</script>

<script type="text/javascript">

	// function getStars(players) {
	// 	var opponents = players.length - 1;
	// 	if (opponents == 1) {
	// 		return 5;
	// 	} else {
	// 		return opponents * 4;
	// 	}
	// }

	var PlayerList = new Ractive({
		el: 'content',
		template: '#template',
		data: {
			players: [
				{ id: 1, name: 'Ronald' },
				{ id: 2, name: 'Tjisse' },
				{ id: 3, name: 'Koop' },
				{ id: 4, name: 'Tjerk' },
				{ id: 5, name: 'Harold' }
			],
			ratings: {
				1: 1,
				2: 1,
				3: 1,
				4: 1,
				5: 1
			},
			starsMax: 15,
			starsGiven: 5,
			starsAvailable: 15
		}
	});

	PlayerList.on('setRating', function(evt, player) {
		var rating = parseInt(evt.node.value);
		PlayerList.set('ratings[' + player.id + ']', rating);
	});

	PlayerList.on('save', function() {
		var ratings = PlayerList.get('ratings');
		console.log(ratings);
	});

	PlayerList.on('clear', function(evt) {
		PlayerList.set('ratings', { 1: 1, 2: 1, 3: 1, 4: 1, 5: 1 });
		evt.original.preventDefault();
	});

	PlayerList.observe('ratings', function() {
		var ratings = PlayerList.get('ratings');
		var starsMax = PlayerList.get('starsMax');

		var starsGiven = _.reduce(_.values(ratings), function(memo, val) {
			return memo + parseInt(val);
		}, 0);

		PlayerList.set('starsGiven', starsGiven);

		PlayerList.set('starsAvailable', starsMax - starsGiven);
	});

</script>
</body>
</html>