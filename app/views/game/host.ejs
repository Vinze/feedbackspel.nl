<!DOCTYPE html>
<html lang="nl">
<head>
	<% include ../includes/head %>
</head>
<body class="ingame host">
<% include ../includes/sidebar %>
<div class="site-wrapper">
	<a href="#" class="nav-toggle">
		<img src="/img/icon-menu.png" width="34px" height="26px">
	</a>

	<div id="game">
	</div>

	<div class="players" id="players">
	</div>
</div>
<% include ../includes/scripts %>

<script type="text/javascript" src="/js/libs/cookies.min.js"></script>
<script type="text/javascript" src="/socket.io/socket.io.js"></script>

<script type="text/template" id="game-tpl">
	<div class="card">
		{{card}}
	</div>
</script>

<script type="text/template" id="players-tpl">
	<ul>
		{{#each users}}
			<li class="player {{ready ? 'ready' : ''}}">
				<div class="avatar">
					<img src="/avatar/{{_id}}.png">
				</div>
				<div class="name">
					{{firstname}} {{lastname}}
				</div>
			</li>
		{{/each}}
	</ul>
</script>

<script type="text/javascript">
	var token = Cookies.get('fbs_token');
	var url = 'http://' + window.location.hostname + ':1337';
	var socket = io(url, { query: 'token=' + token + '&role=host' });

	var Game = new Ractive({
		el: 'game',
		template: '#game-tpl',
		data: { card: null }
	});

	var PlayerList = new Ractive({
		el: 'players',
		template: '#players-tpl',
		data: { users: [] }
	});

	socket.on('users.updated', function(users) {
		PlayerList.set('users', users)
	});

	socket.on('card.new', function(card) {
		Game.set('card', card);
	});
</script>